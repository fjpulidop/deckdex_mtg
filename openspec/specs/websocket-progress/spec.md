# WebSocket Progress

Real-time progress for jobs. **Endpoint:** /ws/progress/{job_id}. Valid job_id required; invalid → close 4004 "Job not found". Multiple clients per job; broadcast to all.

**Authentication:** WebSocket connections SHALL be authenticated via the `access_token` HTTP-only cookie (same JWT used by REST endpoints). The server reads `websocket.cookies.get("access_token")` on connect; if missing or invalid, closes with code 4001 "Authentication required". Query parameter tokens are NOT supported (prevents token leakage in server logs and browser history).

**Events (JSON):** type (progress|error|complete), timestamp ISO8601. Progress: current, total, percentage, batch_size, elapsed_seconds, estimated_remaining_seconds. Error: card_name, error_type, message; connection stays open; cap individual errors (e.g. 100) then summary. Complete: status (success|cancelled), total_processed, success_count, error_count, duration_seconds; then close 1000. **Lifecycle:** Client disconnect → process continues. Server error → error event, close 1011. Ping every 30s if idle. Cleanup job state 5 min after all disconnect + complete. **On connect:** If job running and progress>0, send current progress after "connected" ack. If job complete/error, send complete event from _job_results. "connected" includes job_status. New job (total 0) → ack only. Integrate with ProcessorService callback; queue events for async loop from thread. Isolate state per job_id. Log connect/disconnect at INFO; errors at ERROR.
