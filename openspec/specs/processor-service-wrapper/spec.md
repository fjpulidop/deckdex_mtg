# ProcessorService Wrapper

Wraps MagicCardProcessor for API; async callbacks; no core logic change. **Init:** ProcessorConfig, optional progress_callback. Delegates process_cards() / update_prices_data() unchanged.

**Async:** process_cards_async(), update_prices_async() run in thread pool; return awaitable. **Callbacks:** progress {type, current, total, batch_size}; error {type, card_name, error_message}; complete {type, summary}. Optional; no callback → normal run. **Progress capture:** Intercept tqdm (stderr/stdout) via ProgressCapture; regex extract %/current/total; run_coroutine_threadsafe to event loop. **Cancellation:** cancel_async() sets _cancel_flag; ProgressCapture raises JobCancelledException on write/flush when set; processor catches, returns {status: 'cancelled'}; restore streams in finally. One complete event on cancel; no progress after cancel. cancel() sync variant (no WebSocket emit). Thread-safe state (lock); reuse processor retry/error/CSV; respect dry_run. Expose start_time, config copy, job_id (UUID). Catch processor exceptions → callback error + re-raise; callback exception → log and continue. Testable with mock processor/callback.
